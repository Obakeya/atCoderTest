## 計算量とは

アルゴリズムの効率性を測る指標

### 計算量をイメージするために

https://www.bigocheatsheet.com/
オーダー記法ごとの計算量の増加がグラフ化されており、視覚的に分かりやすい。

Big-O...入力サイズに応じて実行時間や空間使用量がどれだけ増加するかを表す数学的な記法

Complexity...複雑性/計算量

「n log n」は「データ量(n)に対して、処理回数が n\*log(n)回になる」という意味

「log」とは、「ある数を何回半分にすると 1 になるか」を表す：

- log₂(8)= 3 → 8 を 3 回半分にすると 1 になる（8→4→2→1）

ある処理の計算量が n log n だとします。この時、「n 個のデータを処理する際に、各データに対して、約 log(n)回の操作が比兆」と考えれる。
例えば、マージソートでは：

1. データを繰り返し半分に分割（log n 回の分割ステップ）
2. 各ステップで全データ(n)を処理

となります。多くのソートアルゴリズムに log n が現れるのは、データを分割して処理する、という方法に由来します。

### 時間計算量（Time Complexity）

「どのくらい時間がかかるか」 = 実行される処理の回数

```typescript
// O(1) - 定数時間
const first = arr[0]

// O(N) - 線形時間
for (let i = 0; i < N; i++) {
  console.log(arr[i])
}

// O(N²) - 二次時間
for (let i = 0; i < N; i++) {
  for (let j = 0; j < N; j++) {
    console.log(arr[i], arr[j])
  }
}
```

### 空間計算量（Space Complexity）

「どのくらいメモリを使うか」 = 使用される変数・配列のサイズ

```typescript
// O(1) - 定数空間
let sum = 0
for (let i = 0; i < N; i++) {
  sum += arr[i] // 新しい変数は作らない
}

// O(N) - 線形空間
const copy = []
for (let i = 0; i < N; i++) {
  copy.push(arr[i]) // N 個の要素を保存
}
```

## なぜメモリ使用量を減らすことが重要か

結論、パフォーマンスを上げるため。

1. ガベージコレクションへの直接的影響
   現代のオブジェクト指向言語の多くはガベージコレクションを採用していますが、メモリ使用量が GC の頻度と停止時間に直結します。メモリを大量消費すると、GC が頻繁に発生し、アプリケーションの応答性が著しく悪化します。
2. キャッシュヒット率の決定的影響
   メモリ使用量が増加すると、必要なデータが CPU キャッシュに収まらなくなり、キャッシュミス率が急激に上昇します。その結果、同じアルゴリズムでも実行時間が数倍から数十倍に増加し、システム全体のスループットが劇的に低下します。
3. オブジェクト間参照によるメモリ断片化による、ヒット率の低下
   オブジェクト指向設計では、オブジェクト間の関連により間接的なメモリアクセスが多発します。これらのオブジェクトはヒープ上に散在するため、関連するデータが物理的に離れた場所に配置され、メモリの断片化が進行します。メモリ使用量が多いほど、この断片化は深刻化します。

補足

### 「必要なデータが CPU キャッシュに収まらなくなる」とは？

CPU キャッシュは容量が限られています（L1: 32KB、L2: 256KB、L3: 8MB 程度）。メモリ使用量が多いと、頻繁に使用するデータがキャッシュから追い出され、300 倍遅いメインメモリへのアクセスが必要になります。キャッシュは「最近使ったデータを保持する場所」なので、データ量が多いほど「最近使ったデータ」がキャッシュに残らなくなります。

### メモリ断片化についてキャッシュ効率が悪くなるとは

断片化により関連するデータが物理的に離れた場所に配置されます。CPU は 64 バイト単位でデータを読み込むため、関連データが近くにないと複数回のメモリアクセスが必要となり、キャッシュ効率が悪化します。また、大きな連続領域が確保できないため、メモリ不足エラーが発生しやすくなります。

### スタックは使いまくっていいのか？

スタックは GC の対象外で高速ですが、容量が極めて限られています（通常 1-8MB）。大量のデータや深い再帰処理ではスタックオーバーフローが発生します。また、スコープを出ると自動的にデータが消えるため、長期間保持したいデータには使えません。適材適所での使い分けが重要です。
